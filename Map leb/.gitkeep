<!DOCTYPE html>
<html dir="ltr" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø®Ø±ÙŠØ·Ø© Ù„Ø¨Ù†Ø§Ù† - ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø§Ø¹ØªØ¯Ø§Ø¡Ø§Øª</title>
    
    <!-- Ù…ÙƒØªØ¨Ø© Leaflet Ù„Ù„Ø®Ø±ÙŠØ·Ø© -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Bootstrap Ù„Ù„ØªØµÙ…ÙŠÙ… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            direction: rtl;
        }
        #map-container {
            height: 70vh;
            width: 100%;
            margin-top: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        #controls {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin: 10px;
        }
        .incident-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: 0.2s;
        }
        .incident-item:hover {
            background-color: #e9ecef;
            border-color: #adb5bd;
        }
        .incident-item.selected {
            background-color: #cfe2ff;
            border-color: #0d6efd;
        }
        .delete-btn {
            float: left;
            color: red;
            cursor: pointer;
            font-weight: bold;
        }
        #search-box {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        #stats {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-8">
                <h2 class="text-center my-3">ğŸ‡±ğŸ‡§ Ø®Ø±ÙŠØ·Ø© Ù„Ø¨Ù†Ø§Ù† - ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø§Ø¹ØªØ¯Ø§Ø¡Ø§Øª</h2>
                <div id="map-container"></div>
                <div class="text-muted mt-2 text-center">
                    ğŸ–±ï¸ Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙÙŠ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ø¹ØªØ¯Ø§Ø¡ Ø¬Ø¯ÙŠØ¯
                </div>
            </div>
            <div class="col-md-4">
                <div id="controls">
                    <h5>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø¹ØªØ¯Ø§Ø¡Ø§Øª</h5>
                    <input type="text" id="search-box" placeholder="ğŸ” Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ù„ÙˆØµÙ Ø£Ùˆ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©...">
                    <div id="incidents-list" style="max-height: 50vh; overflow-y: auto;">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                    </div>
                    <div id="stats"></div>
                    <hr>
                    <button class="btn btn-danger btn-sm" id="clear-all">ğŸ§¹ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
                    <button class="btn btn-success btn-sm" id="export-btn">ğŸ“¥ ØªØµØ¯ÙŠØ± ÙƒÙ€ JSON</button>
                    <button class="btn btn-primary btn-sm" id="import-btn" onclick="document.getElementById('import-file').click()">ğŸ“¤ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Ù…Ù„Ù</button>
                    <input type="file" id="import-file" accept=".json" style="display: none;">
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªØ¯Ø§Ø¡ -->
    <div class="modal fade" id="incidentModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Ø¥Ø¶Ø§ÙØ© Ø§Ø¹ØªØ¯Ø§Ø¡ Ø¬Ø¯ÙŠØ¯</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="incidentForm">
                        <div class="mb-3">
                            <label for="incident-type" class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø¹ØªØ¯Ø§Ø¡</label>
                            <select class="form-select" id="incident-type" required>
                                <option value="Ù‚ØµÙ">ğŸ’¥ Ù‚ØµÙ</option>
                                <option value="ØªÙˆØºÙ„">ğŸš ØªÙˆØºÙ„</option>
                                <option value="Ø§ØºØªÙŠØ§Ù„">ğŸ”« Ø§ØºØªÙŠØ§Ù„</option>
                                <option value="Ø§Ø¹ØªÙ‚Ø§Ù„">â›“ï¸ Ø§Ø¹ØªÙ‚Ø§Ù„</option>
                                <option value="Ù‡Ø¬ÙˆÙ… Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ">ğŸ’» Ù‡Ø¬ÙˆÙ… Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</option>
                                <option value="Ø£Ø®Ø±Ù‰">â“ Ø£Ø®Ø±Ù‰</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="incident-date" class="form-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" class="form-control" id="incident-date" required>
                        </div>
                        <div class="mb-3">
                            <label for="incident-description" class="form-label">ÙˆØµÙ Ù…Ø®ØªØµØ±</label>
                            <textarea class="form-control" id="incident-description" rows="2" placeholder="Ù…Ø«Ø§Ù„: Ù‚ØµÙ Ù…Ø¯ÙØ¹ÙŠ Ø¹Ù„Ù‰ Ø¨Ù„Ø¯Ø© Ø§Ù„Ø®ÙŠØ§Ù…" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="incident-location" class="form-label">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input type="text" class="form-control" id="incident-location" placeholder="Ù…Ø«Ø§Ù„: ØµÙˆØ±ØŒ Ø¨Ù†Øª Ø¬Ø¨ÙŠÙ„...">
                        </div>
                        <input type="hidden" id="incident-lat">
                        <input type="hidden" id="incident-lng">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                    <button type="button" class="btn btn-primary" id="save-incident">Ø­ÙØ¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS (Ù„Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        var map = L.map('map-container').setView([33.8547, 35.8623], 8); // Ù„Ø¨Ù†Ø§Ù†

        // Ø§Ø³ØªØ®Ø¯Ø§Ù… OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        // Ù…ØµÙÙˆÙØ© Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø§Ø¹ØªØ¯Ø§Ø¡Ø§Øª
        let incidents = [];

        // Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        let markersLayer = L.layerGroup().addTo(map);

        // Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        const STORAGE_KEY = 'lebanon_incidents';

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage
        function loadIncidents() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    incidents = JSON.parse(saved);
                } catch (e) {
                    incidents = [];
                }
            } else {
                // Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ØªØ¬Ø±ÙŠØ¨ÙŠØ© (ÙŠÙ…ÙƒÙ† Ø­Ø°ÙÙ‡Ø§)
                incidents = [
                    { id: Date.now() - 100000, type: 'Ù‚ØµÙ', date: '2024-02-14', description: 'Ù‚ØµÙ Ù…Ø¯ÙØ¹ÙŠ Ø¹Ù„Ù‰ Ø£Ø·Ø±Ø§Ù Ø¨Ù„Ø¯Ø© Ù…ÙŠØ³ Ø§Ù„Ø¬Ø¨Ù„', location: 'Ù…ÙŠØ³ Ø§Ù„Ø¬Ø¨Ù„', lat: 33.164, lng: 35.528 },
                    { id: Date.now() - 200000, type: 'ØªÙˆØºÙ„', date: '2024-02-10', description: 'ØªÙˆØºÙ„ Ù…Ø­Ø¯ÙˆØ¯ Ù„Ø¢Ù„ÙŠØ§Øª Ø¥Ø³Ø±Ø§Ø¦ÙŠÙ„ÙŠØ© ÙÙŠ Ø®Ø±Ø§Ø¬ Ø¨Ù„Ø¯Ø© Ø±Ø§Ù…ÙŠØ©', location: 'Ø±Ø§Ù…ÙŠØ©', lat: 33.102, lng: 35.337 },
                    { id: Date.now() - 300000, type: 'Ø§ØºØªÙŠØ§Ù„', date: '2024-01-30', description: 'Ø§ØºØªÙŠØ§Ù„ Ø£Ø­Ø¯ Ø¹Ù†Ø§ØµØ± Ø­Ø²Ø¨ Ø§Ù„Ù„Ù‡ Ø¨ØµØ§Ø±ÙˆØ® Ù…ÙˆØ¬Ù‡', location: 'Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø´Ø±Ù‚ÙŠ', lat: 33.216, lng: 35.577 }
                ];
            }
            refreshMarkers();
            renderIncidentsList();
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ localStorage
        function saveIncidents() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(incidents));
        }

        // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        function refreshMarkers() {
            markersLayer.clearLayers();
            incidents.forEach(inc => {
                // Ø§Ø®ØªÙŠØ§Ø± Ø±Ù…Ø² Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
                let iconUrl = 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png';
                if (inc.type === 'Ù‚ØµÙ') iconUrl = 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png';
                else if (inc.type === 'ØªÙˆØºÙ„') iconUrl = 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-orange.png';
                else if (inc.type === 'Ø§ØºØªÙŠØ§Ù„') iconUrl = 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-black.png';
                else if (inc.type === 'Ø§Ø¹ØªÙ‚Ø§Ù„') iconUrl = 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png';
                
                var marker = L.marker([inc.lat, inc.lng], {
                    icon: L.icon({
                        iconUrl: iconUrl,
                        shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41],
                        popupAnchor: [1, -34],
                        shadowSize: [41, 41]
                    })
                }).bindPopup(`
                    <b>${inc.type}</b><br>
                    ğŸ“… ${inc.date}<br>
                    ğŸ“ ${inc.description}<br>
                    ğŸ“ ${inc.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
                    <small>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª: ${inc.lat.toFixed(4)}, ${inc.lng.toFixed(4)}</small>
                `);
                
                marker.incidentId = inc.id;
                marker.on('click', function() {
                    // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø¹Ù†ØµØ± ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                    highlightIncident(inc.id);
                });
                markersLayer.addLayer(marker);
            });
        }

        // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø¹ØªØ¯Ø§Ø¡Ø§Øª
        function renderIncidentsList(filterText = '') {
            const listDiv = document.getElementById('incidents-list');
            const statsDiv = document.getElementById('stats');
            
            let filtered = incidents;
            if (filterText.trim() !== '') {
                const f = filterText.toLowerCase();
                filtered = incidents.filter(inc => 
                    inc.description.toLowerCase().includes(f) || 
                    (inc.location && inc.location.toLowerCase().includes(f))
                );
            }
            
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            statsDiv.innerText = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${incidents.length} Ø§Ø¹ØªØ¯Ø§Ø¡ | Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶: ${filtered.length}`;
            
            if (filtered.length === 0) {
                listDiv.innerHTML = '<div class="text-muted text-center p-3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø¹ØªØ¯Ø§Ø¡Ø§Øª Ù…Ø³Ø¬Ù„Ø©</div>';
                return;
            }
            
            // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø£Ø­Ø¯Ø«
            filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let html = '';
            filtered.forEach(inc => {
                html += `
                    <div class="incident-item" data-id="${inc.id}">
                        <span class="delete-btn" onclick="deleteIncident(${inc.id}, event)">ğŸ—‘ï¸</span>
                        <strong>${inc.type}</strong> - ${inc.date}<br>
                        <small>${inc.description}</small><br>
                        <small>ğŸ“ ${inc.location || ''}</small>
                    </div>
                `;
            });
            listDiv.innerHTML = html;
            
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ØµØ± Ù„ØªØ­Ø¯ÙŠØ¯Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
            document.querySelectorAll('.incident-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    if (e.target.classList.contains('delete-btn')) return;
                    const id = parseInt(this.dataset.id);
                    highlightIncident(id);
                });
            });
        }

        // ØªÙ…ÙŠÙŠØ² Ø§Ø¹ØªØ¯Ø§Ø¡ Ù…Ø¹ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        function highlightIncident(id) {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±
            document.querySelectorAll('.incident-item').forEach(el => el.classList.remove('selected'));
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚
            const selectedEl = document.querySelector(`.incident-item[data-id="${id}"]`);
            if (selectedEl) selectedEl.classList.add('selected');
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù„Ø§Ù…Ø© ÙˆØªÙƒØ¨ÙŠØ±Ù‡Ø§
            markersLayer.eachLayer(layer => {
                if (layer.incidentId === id) {
                    layer.openPopup();
                    // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¥Ù„ÙŠÙ‡Ø§
                    map.setView(layer.getLatLng(), 12);
                }
            });
        }

        // Ø­Ø°Ù Ø§Ø¹ØªØ¯Ø§Ø¡
        window.deleteIncident = function(id, event) {
            event.stopPropagation();
            incidents = incidents.filter(inc => inc.id !== id);
            saveIncidents();
            refreshMarkers();
            renderIncidentsList(document.getElementById('search-box').value);
        };

        // Ø­Ø°Ù Ø§Ù„ÙƒÙ„
        document.getElementById('clear-all').addEventListener('click', function() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø¹ØªØ¯Ø§Ø¡Ø§ØªØŸ')) {
                incidents = [];
                saveIncidents();
                refreshMarkers();
                renderIncidentsList('');
            }
        });

        // ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ JSON
        document.getElementById('export-btn').addEventListener('click', function() {
            const dataStr = JSON.stringify(incidents, null, 2);
            const blob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `lebanon_incidents_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        });

        // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Ù…Ù„Ù
        document.getElementById('import-file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(ev) {
                try {
                    const imported = JSON.parse(ev.target.result);
                    if (Array.isArray(imported)) {
                        // Ø¯Ù…Ø¬ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© (ØªØ¬Ù†Ø¨ ØªÙƒØ±Ø§Ø± id)
                        const newIds = imported.map(inc => inc.id);
                        incidents = incidents.filter(inc => !newIds.includes(inc.id));
                        incidents = incidents.concat(imported);
                        saveIncidents();
                        refreshMarkers();
                        renderIncidentsList('');
                        alert('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ' + imported.length + ' Ø§Ø¹ØªØ¯Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­.');
                    } else {
                        alert('Ø§Ù„Ù…Ù„Ù Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…ØµÙÙˆÙØ© ØµØ­ÙŠØ­Ø©.');
                    }
                } catch (err) {
                    alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: ' + err);
                }
                document.getElementById('import-file').value = ''; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
            };
            reader.readAsText(file);
        });

        // Ø§Ù„Ø¨Ø­Ø«
        document.getElementById('search-box').addEventListener('input', function(e) {
            renderIncidentsList(e.target.value);
        });

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        let currentLatLng = null;
        const modal = new bootstrap.Modal(document.getElementById('incidentModal'));

        // Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        map.on('click', function(e) {
            currentLatLng = e.latlng;
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø®ÙÙŠØ©
            document.getElementById('incident-lat').value = currentLatLng.lat;
            document.getElementById('incident-lng').value = currentLatLng.lng;
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
            const today = new Date().toISOString().slice(0,10);
            document.getElementById('incident-date').value = today;
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('incidentForm').reset();
            document.getElementById('incident-date').value = today;
            // ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø©
            modal.show();
        });

        // Ø­ÙØ¸ Ø§Ù„Ø§Ø¹ØªØ¯Ø§Ø¡ Ù…Ù† Ø§Ù„Ù†Ø§ÙØ°Ø©
        document.getElementById('save-incident').addEventListener('click', function() {
            const type = document.getElementById('incident-type').value;
            const date = document.getElementById('incident-date').value;
            const description = document.getElementById('incident-description').value;
            const location = document.getElementById('incident-location').value;
            const lat = parseFloat(document.getElementById('incident-lat').value);
            const lng = parseFloat(document.getElementById('incident-lng').value);

            if (!type || !date || !description) {
                alert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.');
                return;
            }

            const newIncident = {
                id: Date.now(), // Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯
                type: type,
                date: date,
                description: description,
                location: location || '',
                lat: lat,
                lng: lng
            };

            incidents.push(newIncident);
            saveIncidents();
            refreshMarkers();
            renderIncidentsList(document.getElementById('search-box').value);
            modal.hide();
        });

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        loadIncidents();

        // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
        L.control.locate().addTo(map);
    </script>
    <!-- Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØªØ¨Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.79.0/L.Control.Locate.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.79.0/L.Control.Locate.min.css" />
</body>
</html>