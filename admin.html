<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حجرة القيادة | رادار 24 السحابي</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body style="background: #eef2f7;">

    <div id="loginGate" class="admin-login-wrapper">
        <i class="fas fa-lock-open" style="font-size: 3rem; color: var(--main-blue); margin-bottom: 15px;"></i>
        <h2 style="color: var(--main-blue);">بوابة الناشرين</h2>
        <p style="color: #666; margin-bottom: 25px;">يرجى إثبات الهوية للوصول للرادار العالمي</p>
        <input type="password" id="adminPass" placeholder="كلمة المرور السرية" style="width:100%; padding:15px; border-radius:10px; border:1px solid #ddd; text-align: center; font-size: 1.1rem; margin-bottom: 20px;">
        <button onclick="unlockRadar()" class="btn-post">دخول النظام</button>
    </div>

    <div id="radarDashboard" class="container" style="display: none; padding: 40px 0;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h2 style="color: var(--main-blue);"><i class="fas fa-cloud-upload-alt"></i> إضافة خبر للميدان السحابي</h2>
            <button onclick="location.reload()" style="background: #ddd; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">خروج</button>
        </div>

        <div class="admin-panel">
            <div class="input-group">
                <label>عنوان الخبر الرئيسي:</label>
                <input type="text" id="newsTitle" placeholder="اكتب عنواناً جذاباً وقوياً...">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="input-group">
                    <label>تصنيف الخبر:</label>
                    <select id="newsCategory">
                        <option value="أخبار العالم">أخبار العالم</option>
                        <option value="عاجل">عاجل</option>
                        <option value="سياسة">سياسة</option>
                        <option value="تكنولوجيا">تكنولوجيا</option>
                        <option value="ميداني">ميداني</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>الصورة (من الاستوديو):</label>
                    <input type="file" id="imageInput" accept="image/*" style="border: none; background: #f9f9f9;">
                </div>
            </div>

            <div id="previewWrap" style="display:none; margin-bottom: 20px;">
                <p style="font-size: 0.8rem; color: #888;">معاينة الصورة المختارة:</p>
                <img id="previewImg" style="width: 200px; height: 120px; object-fit: cover; border-radius: 8px; border: 2px solid var(--main-blue);">
            </div>

            <div class="input-group">
                <label>نص الخبر التفصيلي:</label>
                <textarea id="newsContent" rows="8" placeholder="اكتب تفاصيل الخبر كاملة هنا..."></textarea>
            </div>

            <button onclick="publishToRadar()" class="btn-post" id="publishBtn">
                <i class="fas fa-upload"></i> نشر الخبر عالمياً الآن
            </button>
        </div>
    </div>

    <script>
        // إعدادات Firebase الخاصة بك
        const firebaseConfig = {
            databaseURL: "https://radar24lb-972bb-default-rtdb.europe-west1.firebasedatabase.app/"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function unlockRadar() {
            // كلمة السر الخاصة بك
            if(document.getElementById('adminPass').value === "hassan@123456789") {
                document.getElementById('loginGate').style.display = 'none';
                document.getElementById('radarDashboard').style.display = 'block';
            } else { alert("كلمة السر خاطئة!"); }
        }

        document.getElementById('imageInput').onchange = function(evt) {
            const [file] = evt.target.files;
            if (file) {
                document.getElementById('previewImg').src = URL.createObjectURL(file);
                document.getElementById('previewWrap').style.display = 'block';
            }
        }

        function publishToRadar() {
            const title = document.getElementById('newsTitle').value;
            const category = document.getElementById('newsCategory').value;
            const text = document.getElementById('newsContent').value;
            const imageFile = document.getElementById('imageInput').files[0];
            const time = new Date().toLocaleString('ar-EG', { hour: 'numeric', minute: 'numeric', day: 'numeric', month: 'long' });

            if(!title || !imageFile || !text) {
                alert("برجاء إكمال جميع البيانات!");
                return;
            }

            const btn = document.getElementById('publishBtn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الرفع للسحابة...';
            btn.disabled = true;

            const reader = new FileReader();
            reader.onloadend = function() {
                const base64Image = reader.result;
                const newEntry = { title, category, image: base64Image, text, time };
                
                // إرسال البيانات إلى Firebase
                db.ref('allNews').push(newEntry)
                .then(() => {
                    alert("تم نشر الخبر بنجاح ووصل لجميع المتابعين!");
                    location.reload();
                })
                .catch((error) => {
                    alert("حدث خطأ في السحابة: " + error.message);
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-upload"></i> نشر الخبر في الرادار الآن';
                });
            }
            reader.readAsDataURL(imageFile);
        }
    </script>
</body>
</html>