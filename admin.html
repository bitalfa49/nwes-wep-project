<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حجرة القيادة | رادار 24</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body style="background: #eef2f7;">

    <div id="loginGate" style="max-width: 400px; margin: 100px auto; background: white; padding: 30px; border-radius: 15px; text-align: center; box-shadow: var(--shadow);">
        <i class="fas fa-user-shield" style="font-size: 3rem; color: var(--main-blue); margin-bottom: 15px;"></i>
        <h2 style="margin-bottom: 20px;">دخول الإدارة</h2>
        <input type="password" id="adminPass" placeholder="كلمة المرور" style="width:100%; padding:12px; margin-bottom:15px; border-radius:8px; border:1px solid #ddd; text-align:center;">
        <button onclick="unlockRadar()" class="btn-post">دخول</button>
    </div>

    <div id="radarDashboard" class="container" style="display: none; padding: 30px 0;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
            <h2><i class="fas fa-edit"></i> إضافة خبر جديد</h2>
            <button onclick="location.href='index.html'" style="background:var(--main-blue); color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">العودة للرئيسية</button>
        </div>

        <div class="admin-panel">
            <div class="input-group">
                <label>العنوان:</label>
                <input type="text" id="newsTitle" placeholder="عنوان الخبر...">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="input-group">
                    <label>القسم:</label>
                    <select id="newsCategory">
                        <option value="عاجل">عاجل</option>
                        <option value="أخبار العالم">أخبار العالم</option>
                        <option value="سياسة">سياسة</option>
                        <option value="رياضة">رياضة</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>الصورة (اختياري):</label>
                    <input type="file" id="imageInput" accept="image/*">
                </div>
            </div>

            <div class="input-group">
                <label>نص الخبر:</label>
                <textarea id="newsContent" rows="5" placeholder="تفاصيل الخبر..."></textarea>
            </div>

            <button onclick="publishToRadar()" class="btn-post" id="publishBtn">نشر الخبر الآن</button>
        </div>

        <h3 style="margin-top: 40px; color: #D4AF37; border-bottom: 2px solid #D4AF37; padding-bottom: 10px;">
            <i class="fas fa-crown"></i> إضافة داعم للموقع
        </h3>
        <div class="admin-panel" style="border: 2px solid #D4AF37; margin-top: 20px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="input-group">
                    <label>اسم الداعم:</label>
                    <input type="text" id="supporterName" placeholder="الاسم الكامل">
                </div>
                <div class="input-group">
                    <label>المبلغ (للترتيب التلقائي):</label>
                    <input type="number" id="supporterAmount" placeholder="مثال: 100">
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="input-group">
                    <label>صورة الداعم (اختياري):</label>
                    <input type="file" id="supporterImage" accept="image/*">
                </div>
                <div class="input-group">
                    <label>خصوصية المبلغ:</label>
                    <select id="amountPrivacy">
                        <option value="show">إظهار المبلغ</option>
                        <option value="hide">إخفاء (وضع نجوم ***)</option>
                    </select>
                </div>
            </div>
            <button onclick="addSupporter()" class="btn-post" style="background: #D4AF37;">إضافة الداعم للوحة الشرف</button>
        </div>

        <h3 style="margin-top: 40px; color: var(--main-blue); border-bottom: 2px solid #ddd; padding-bottom: 10px;">
            <i class="fas fa-tasks"></i> إدارة المحتوى المنشور
        </h3>
        <div id="adminNewsList" style="margin-top: 20px;"></div>
        <div id="adminSupportersList" style="margin-top: 20px; border-top: 2px dashed #D4AF37; padding-top: 20px;"></div>
    </div>

    <script>
        const firebaseConfig = {
            databaseURL: "https://radar24lb-972bb-default-rtdb.europe-west1.firebasedatabase.app/"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function unlockRadar() {
            if(document.getElementById('adminPass').value === "hassan@123456789") {
                document.getElementById('loginGate').style.display = 'none';
                document.getElementById('radarDashboard').style.display = 'block';
                loadAdminNews(); 
                loadAdminSupporters();
            } else { alert("خطأ!"); }
        }

        function publishToRadar() {
            const title = document.getElementById('newsTitle').value;
            const category = document.getElementById('newsCategory').value;
            const text = document.getElementById('newsContent').value;
            const imageFile = document.getElementById('imageInput').files[0];
            const time = new Date().toLocaleString('ar-EG', { hour: 'numeric', minute: 'numeric', day: 'numeric', month: 'long' });

            if(!title || !text) { alert("أكمل البيانات!"); return; }

            const btn = document.getElementById('publishBtn');
            btn.disabled = true;
            btn.innerText = "جاري النشر...";

            if (imageFile) {
                const reader = new FileReader();
                reader.onloadend = () => sendToFirebase({ title, category, text, time, image: reader.result });
                reader.readAsDataURL(imageFile);
            } else {
                sendToFirebase({ title, category, text, time, image: "" });
            }
        }

        function sendToFirebase(data) {
            db.ref('allNews').push(data).then(() => {
                alert("تم النشر!");
                location.reload();
            });
        }

        function addSupporter() {
            const name = document.getElementById('supporterName').value;
            const amount = parseFloat(document.getElementById('supporterAmount').value) || 0;
            const privacy = document.getElementById('amountPrivacy').value;
            const imageFile = document.getElementById('supporterImage').files[0];

            if(!name) { alert("أدخل اسم الداعم!"); return; }

            if (imageFile) {
                const reader = new FileReader();
                reader.onloadend = () => {
                    db.ref('supporters').push({ name, amount, privacy, image: reader.result }).then(() => location.reload());
                };
                reader.readAsDataURL(imageFile);
            } else {
                db.ref('supporters').push({ name, amount, privacy, image: "" }).then(() => location.reload());
            }
        }

        function loadAdminNews() {
            const listDiv = document.getElementById('adminNewsList');
            db.ref('allNews').on('value', (snapshot) => {
                const data = snapshot.val();
                listDiv.innerHTML = '<h4>الأخبار:</h4>';
                if (!data) return;
                Object.keys(data).reverse().forEach(id => {
                    const news = data[id];
                    listDiv.innerHTML += `
                        <div style="background:white; padding:15px; border-radius:8px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                            <div><strong>${news.title}</strong></div>
                            <button onclick="deleteItem('allNews', '${id}')" style="background:#ff4444; color:white; border:none; padding:8px 12px; border-radius:5px; cursor:pointer;"><i class="fas fa-trash"></i></button>
                        </div>`;
                });
            });
        }

        function loadAdminSupporters() {
            const listDiv = document.getElementById('adminSupportersList');
            db.ref('supporters').on('value', (snapshot) => {
                const data = snapshot.val();
                listDiv.innerHTML = '<h4>قائمة الداعمين:</h4>';
                if (!data) return;
                Object.keys(data).forEach(id => {
                    const sup = data[id];
                    listDiv.innerHTML += `
                        <div style="background:#fff9e6; padding:15px; border-radius:8px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center; border:1px solid #D4AF37;">
                            <div><strong>${sup.name}</strong> (${sup.amount}$)</div>
                            <button onclick="deleteItem('supporters', '${id}')" style="background:#ff4444; color:white; border:none; padding:8px 12px; border-radius:5px; cursor:pointer;"><i class="fas fa-trash"></i></button>
                        </div>`;
                });
            });
        }

        function deleteItem(path, id) {
            if(confirm("هل أنت متأكد؟")) {
                db.ref(path).child(id).remove().then(() => alert("تم الحذف"));
            }
        }
    </script>
</body>
</html>
